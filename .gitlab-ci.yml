image: node:10.15.3

test api:
  stage: test
  services:
  - mysql:8.0.16 
  variables:
    NODE_ENV: test
    MYSQL_DATABASE: "my-random-db-test"
    MYSQL_ROOT_PASSWORD: "default"
  before_script:
    - apt-get install -y mysql-server mysql-client libmysqlclient-dev
    - npm i -g mysql2 sequelize sequelize-cli gulp-cli
    - echo "SELECT 'OK';" | mysql --user=root --password="$MYSQL_ROOT_PASSWORD" --host=mysql "$MYSQL_DATABASE"
    - cd server/
    - sequelize db:migrate --env test
    - cd ../
    - npm install
    - gulp
  script:
    - npm run unit-test
    - npm run integration-test